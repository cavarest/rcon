# Docker Compose for Minecraft RCON Integration Tests
# This file is used by GitHub Actions for integration testing
# Uses high-numbered ports to avoid conflicts with local development servers
#
# Port Configuration (Single Source of Truth):
# - Local testing: 35575 (RCON), 35565 (Minecraft)
# - CI/CD: 35575 (RCON), 35565 (Minecraft)

services:
  minecraft:
    image: itzg/minecraft-server
    container_name: cavarest-rcon-minecraft
    ports:
      - "35565:25565"   # Minecraft server port (exposed on high port)
      - "35575:25575"   # RCON port (exposed on high port)
    environment:
      - EULA=TRUE
      - ONLINE_MODE=false
      - TYPE=PAPER
      - VERSION=1.21.8
      - RCON_PASSWORD=cavarest
      - ENABLE_RCON=true
      - MAX_PLAYERS=5
      - MEMORY=512M
      # Set spawn protection to 0 to allow commands near spawn
      - SPAWN_PROTECTION=0
      # Enable debug logging for troubleshooting
      - DEBUG=false
    volumes:
      - minecraft-data:/data
    healthcheck:
      test: ["CMD", "mc-health"]
      interval: 30s
      timeout: 10s
      retries: 15
      start_period: 120s
    stop_grace_period: 30s

volumes:
  minecraft-data:
