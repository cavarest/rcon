= Cavarest RCON Library

image:https://img.shields.io/badge/Java-11%2B-blue[Java Version]
image:https://img.shields.io/badge/Gradle-8.5-green[Gradle Version]
image:https://img.shields.io/badge/License-MIT-yellow[License]

A Java library for communicating with Minecraft servers using the RCON (Remote
Console) protocol. This library provides a simple and efficient API for sending
commands to Minecraft servers and receiving responses.

== Purpose

The Cavarest RCON library allows developers to integrate RCON functionality into
their Java applications for:

* Server administration and automation
* Server monitoring and alerting
* Plugin administration interfaces
* Multi-server management dashboards
* Automated server maintenance scripts

== Features

* Lightweight and efficient implementation
* Full support for RCON protocol (Source RCON)
* Easy-to-use high-level API via `RconClient`
* Low-level API via `Rcon` class for advanced use cases
* Proper handling of RCON packets and responses
* Support for character encoding (UTF-8, ISO-8859-1 for color codes)
* Thread-safe design for concurrent usage
* Comprehensive test suite with unit and integration tests

== Architecture

=== Source Code Structure

----
src/main/java/org/cavarest/rcon/
├── Packet.java           # Domain model for RCON protocol packets
├── PacketType.java       # Protocol constants (packet types)
├── PacketCodec.java      # Binary encoding/decoding of packets
├── PacketReader.java     # Low-level packet reading from socket
├── PacketWriter.java     # Low-level packet writing to socket
├── Rcon.java             # Core RCON client with builder pattern
└── RconClient.java       # High-level simplified API
----

=== Component Relationships

----
                    ┌──────────────────┐
                    │   RconClient     │  ← Entry point for users
                    │  (High-level)    │
                    └────────┬─────────┘
                             │
                    ┌────────▼─────────┐
                    │      Rcon        │  ← Core client
                    │  (Builder Pattern)│
                    └────────┬─────────┘
                             │
              ┌──────────────┼──────────────┐
              │              │              │
     ┌────────▼─────┐ ┌──────▼─────┐ ┌─────▼──────┐
     │ PacketReader │ │PacketWriter│ │ Request ID │
     │              │ │            │ │ Management │
     └──────┬───────┘ └─────┬──────┘ └────────────┘
            │               │
     ┌──────▼───────┐ ┌─────▼──────┐
     │ PacketCodec  │ │  ByteBuf   │
     │ (Encoding)   │ │ Management │
     └──────┬───────┘ └────────────┘
            │
     ┌──────▼───────┐
     │   Packet     │  ← Immutable domain model
     │   PacketType │  ← Constants
     └──────────────┘
----

== Installation

=== Using Gradle

[source,groovy]
----
dependencies {
    implementation 'org.cavarest:cavarest-rcon:0.1.0'
}
----

=== Building from Source

[source,shell]
----
./gradlew build
----

The JAR file will be generated at `build/libs/cavarest-rcon-0.1.0.jar`.

=== Requirements

* Java 11 or higher
* Gradle 8.5 (wrapper included)

== Usage

=== Quick Start

[source,java]
----
import org.cavarest.rcon.RconClient;
import java.io.IOException;

try (RconClient client = new RconClient("localhost", 25575, "password")) {
    client.connect();
    String response = client.sendCommand("say Hello from RCON!");
    System.out.println("Response: " + response);
} catch (IOException e) {
    System.err.println("RCON error: " + e.getMessage());
}
----

=== Using the Low-Level API

[source,java]
----
import org.cavarest.rcon.Rcon;
import java.io.IOException;

try (Rcon rcon = Rcon.connect("localhost", 25575)) {
    if (rcon.authenticate("password")) {
        String response = rcon.sendCommand("list");
        System.out.println("Players: " + response);
    }
} catch (IOException e) {
    System.err.println("RCON error: " + e.getMessage());
}
----

=== Builder Pattern

[source,java]
----
import org.cavarest.rcon.Rcon;
import java.nio.charset.StandardCharsets;

Rcon rcon = Rcon.newBuilder()
    .withChannel(channel)
    .withReadBufferCapacity(8192)
    .withWriteBufferCapacity(4096)
    .withCharset(StandardCharsets.UTF_8)
    .build();
----

== RCON Protocol Notes

=== Packet Format

All integers are stored in **little-endian** byte order.

|===
| Field name | Field type | Notes

| Length     | int32      | Length of remainder of packet
| Request ID | int32      | Client-generated ID
| Type       | int32      | 3 for login, 2 to run a command, 0 for response
| Payload    | byte[]     | NULL-terminated ASCII text
| 1-byte pad | byte       | NULL

|===

=== Packet Types

* **3 (SERVERDATA_AUTH)**: Authentication request
* **2 (SERVERDATA_AUTH_RESPONSE)**: Authentication response (-1 indicates failure)
* **2 (SERVERDATA_EXECCOMMAND)**: Command execution request
* **0 (SERVERDATA_RESPONSE_VALUE)**: Command response

=== Fragmentation

The Minecraft server can fragment responses across multiple packets.

Maximum payload sizes are:

* Client to Server: 1446 bytes
* Server to Client: 4096 bytes

=== Character Encoding

Default is UTF-8. Use `StandardCharsets.ISO_8859_1` for legacy servers that use
color codes (section sign `§`).

[source,java]
----
import java.nio.charset.StandardCharsets;

Rcon rcon = Rcon.newBuilder()
    .withChannel(channel)
    .withCharset(StandardCharsets.ISO_8859_1)
    .build();
----

== Testing

This project includes both unit tests and integration tests to ensure code quality and reliability.

=== Unit Tests

Unit tests verify the core functionality of the RCON library without requiring external dependencies:

[source,shell]
----
./gradlew test
----

Unit tests are fast and suitable for local development. Test reports are generated at `build/reports/tests/test/index.html`.

=== Integration Tests

Integration tests verify the library works correctly against a real Minecraft server using Testcontainers:

[source,shell]
----
./gradlew integrationTest
----

Integration tests require Docker and take longer to run. They are automatically skipped when no Docker daemon is available.

To skip integration tests locally:

[source,shell]
----
SKIP_INTEGRATION_TESTS=true ./gradlew test
----

=== Test Configuration

Tests are organized using JUnit 5 tags:

* *Unit tests*: Tagged with `@Tag("unit")` or no tag, run with `./gradlew test`
* *Integration tests*: Tagged with `@Tag("integration")`, run with `./gradlew integrationTest`

The default `test` task excludes integration tests, ensuring fast local test execution.

== Development Workflow

This section describes the development workflow, testing procedures, and release process.

=== Pre-Release Checklist

Before creating a release, ensure all tests pass:

. Run unit tests:
+
[source,shell]
----
./gradlew test
----

. Run integration tests (requires Docker):
+
[source,shell]
----
./gradlew integrationTest
----

. Verify all code quality checks pass:
+
[source,shell]
----
./gradlew check
----

=== Creating a Release

Releases are automated using GitHub Actions. To create a release:

==== Option 1: Create GitHub Release (Recommended)

. Go to https://github.com/cavarest/rcon/releases/new[new release page]
. Create a new tag (e.g., `v0.1.0`)
. The `Publish Release` workflow will automatically:
  - Build the project
  - Run tests
  - Publish to GitHub Packages

==== Option 2: Push a Git Tag

[source,shell]
----
# Create and push a version tag
git tag v0.1.0
git push origin v0.1.0
----

The `Publish Release` workflow will trigger on the tag push.

==== Option 3: Manual Trigger

Navigate to https://github.com/cavarest/rcon/actions/workflows/publish-release.yml[Publish Release workflow] and click "Run workflow".

=== GitHub Actions Workflows

The project includes the following CI/CD workflows:

[cols="2,3,3"]
|===
| Workflow | Trigger | Purpose

| Unit Tests | On push to main | Runs unit tests on Java 11, 17, and 21

| Integration Tests | On push to main | Tests against Minecraft Paper 1.21.8 server

| Publish Release | On release creation, git tag push, or manual | Builds and publishes to GitHub Packages

| Trigger Release | Manual | Provides a simple button to create a release

| Dependency Submission | On push to main | Submits dependencies to GitHub Dependency Insights
|===

=== Version Management

The project version is defined in `version.properties`. To update the version:

. Edit `version.properties`:
+
[source,properties]
----
version=0.2.0
----

. Commit and tag appropriately

=== Local Build

To build the project locally without running tests:

[source,shell]
----
./gradlew clean build -x test
----

The JAR file will be generated at `build/libs/cavarest-rcon-{version}.jar`.

== Contributing

=== Running Tests

[source,shell]
----
# Run all tests
./gradlew test integrationTest

# Run only unit tests
./gradlew test

# Run integration tests
./gradlew integrationTest

# Clean build
./gradlew clean
----

== License

This project is licensed under the MIT License.

== References

* https://developer.valvesoftware.com/wiki/RCON[Source RCON Protocol]
* https://papermc.io/[PaperMC - Minecraft Server Software]
